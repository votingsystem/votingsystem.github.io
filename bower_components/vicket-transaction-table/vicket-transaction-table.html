<link rel="import" href="../core-ajax/core-ajax.html">

<polymer-element name="vicket-transaction-table" attributes="url params newRecord">
    <template>
        <script src="i18n/messages.js" on-load="{{messagesLoaded}}"></script>
        <style></style>
        <core-ajax id="ajax" auto url="{{url}}" response="{{responseData}}" handleAs="json" method="get"
                   contentType="json" params="{{params}}"></core-ajax>
        <div layout vertical center>
            <div id="transaction_tableDiv" style="margin: 0px auto 0px auto; max-width: 1200px; overflow:auto;">
                <table class="table white_headers_table" id="transaction_table" style="">
                    <thead>
                    <tr style="color: #ff0000;">
                        <th style="width: 300px;">{{messages.typeLbl}}</th>
                        <th style="width:40px;">{{messages.amountLbl}}</th>
                        <th style="width:170px;">{{messages.datecreatedLbl}}</th>
                        <th style="min-width:280px;">{{messages.subjectLbl}}</th>
                    </tr>
                    </thead>
                    <tbody>
                    <template repeat="{{transaction in responseData.transactionRecords}}">
                        <tr><td title=" + transactionType + '" class="text-center">
                            <a href="#" on-click="{{openWindow}}">{{transaction.type| transactionDescription}}</a>
                        </td>
                            <td class="text-right">{{transaction | amount}}</td><td class="text-center">{{transaction.dateCreated}}
                            </td><td title="{{transaction.subject}}" class="text-center">{{transaction.subject}}</td>
                        </tr>
                    </template>
                    </tbody>
                </table>
            </div>
        </div>
    </template>
    <script>
        Polymer('vicket-transaction-table', {
            messagesLoaded:function() {
                console.log("vicket-transaction-table - messages for locale " + userLocale)
                this.messages = localizedMessages
            },
            ready:function() { },
            transactionDescription: function(type) {
                return getTransactionVSDescription(type)
            },
            openWindow: function(e) {
                openWindow(e.target.templateInstance.model.transaction.id)
            },
            newRecordChanged: function(e) {
                console.log("newRecordChanged: " + this.newRecord)
            },
            amount: function(transaction) {
                var amount
                if(isNaN(transaction.amount)) amount = transaction.amount.toFixed(2) + " " + transaction.currency
                else  amount = transaction.amount + " " + transaction.currency
                return amount
            }
        });</script>
</polymer-element>

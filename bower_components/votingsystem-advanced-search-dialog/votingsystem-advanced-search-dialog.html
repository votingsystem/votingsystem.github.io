<!--


Example:

@group Paper Elements
@element votingsystem-advanced-search-dialog
@status alpha
@homepage http://votingsystem.github.io/votingsystem-advanced-search-dialog


-->
<link href="../polymer/polymer.html" rel="import">
<link href="../core-overlay/core-overlay.html" rel="import">
<link href="../paper-shadow/paper-shadow.html" rel="import">
<link href="../paper-dialog/paper-dialog.html" rel="import">
<link href="../paper-fab/paper-fab.html" rel="import">
<link href="../paper-input/paper-input.html" rel="import">
<link href="../core-icons/iconsets/icons.html" rel="import">
<link href="../core-icons/iconsets/icons.html" rel="import">

<!-- a simple dialog element made with core-overlay -->
<polymer-element name="x-dialog" attributes="opened autoCloseDisabled">
    <template>
        <script src="i18n/messages.js" on-load="{{messagesLoaded}}"></script>
        <style>
            :host {
                box-sizing: border-box;
                -moz-box-sizing: border-box;
                -webkit-user-select: none;
                -moz-user-select: none;
                overflow: hidden;
                background: white;
                outline: 1px solid rgba(0,0,0,0.2);
                box-shadow: 0 4px 16px rgba(0,0,0,0.2);
            }
        </style>
        <core-overlay id="overlay" layered backdrop opened="{{opened}}" sizingTarget="{{$.container}}"
                      autoCloseDisabled="{{autoCloseDisabled}}"  transition="core-transition-center"></core-overlay>
        <content></content>
    </template>
    <script>
        Polymer('x-dialog', {
            ready: function() {
                this.$.overlay.target = this;
            },

            toggle: function() {
                this.$.overlay.toggle();
            }
        });
    </script>
</polymer-element>



<polymer-element name="votingsystem-advanced-search-dialog" attributes="opened transition">
    <template>
        <div>
            <x-dialog id="searchDialog"  class="dialog" on-core-overlay-open="{{resetForm}}" opened="{{opened}}">
                <!-- place all overlay styles inside the overlay target -->
                <style no-shim>
                    .dialog {
                        width: auto;
                        height: auto;
                        padding: 10px 15px 15px 15px;
                    }
                </style>
                <div layout horizontal center center-justified style="height: 60px;">
                    <div style="font-size: 1.5em;color: #ba0011; margin:0px 30px 0px 0px;">{{messages.caption}}</div>
                    <paper-fab id="check" icon="check" hidden?="{{!isValidForm}}" on-tap="{{submitForm}}" class="mini"></paper-fab>
                </div>


                <div id="dateSupportedDiv">
                    <div layout horizontal center center-justified style="">
                        <div style="font-weight: bold;width: 100px;">{{messages.fromDate}}: </div>
                        <div>
                            <input id='fromDate' type="date" value="{{fromDateValue}}" on-change="{{validateForm}}" style="width: auto;">
                        </div>
                        <div>
                            <input id='fromTime' type="time" value="{{fromTimeValue}}"  on-change="{{validateForm}}"
                                   style="width: auto; margin:0px 0px 0px 10px;">
                        </div>
                    </div>

                    <div layout horizontal center center-justified style="margin:10px 0px 0px 0px;">
                        <label style="font-weight: bold;width: 100px;">{{messages.toDate}}: </label>
                        <div>
                            <input id='toDate' type="date" value="{{toDateValue}}"  on-change="{{validateForm}}"  style="width: auto;">
                        </div>
                        <div>
                            <input id='toTime' type="time" value="{{toTimeValue}}" on-change="{{validateForm}}"
                                   style="width: auto; margin:0px 0px 0px 10px;">
                        </div>
                    </div>
                </div>
                <div id="">
                    <div layout horizontal style="">
                        <div>
                            <label center center-justified>{{messages.fromDate}}: </label>
                            <paper-input id="dateFrom" value={{dateFromValue}} on-input="{{validateForm}}" floatinglabel label="Fecha (dd/mm/aaaa)"
                                         validate="^(?:(?:31(\/|-|\.)(?:0?[13578]|1[02]))\1|(?:(?:29|30)(\/|-|\.)(?:0?[1,3-9]|1[0-2])\2))(?:(?:1[6-9]|[2-9]\d)?\d{2})$|^(?:29(\/|-|\.)0?2\3(?:(?:(?:1[6-9]|[2-9]\d)?(?:0[48]|[2468][048]|[13579][26])|(?:(?:16|[2468][048]|[3579][26])00))))$|^(?:0?[1-9]|1\d|2[0-8])(\/|-|\.)(?:(?:0?[1-9])|(?:1[0-2]))\4(?:(?:1[6-9]|[2-9]\d)?\d{2})$"
                                         error="No es una fecha v치lida!" style="width:170px; margin:0px 10px 0px 10px;">
                            </paper-input>
                        </div>
                        <div>
                            <paper-input id="hourFrom" value={{dateFromHour}} on-input="{{validateForm}}" floatinglabel label="Hora (HH:mm)"
                                         validate="^([01]?[0-9]|2[0-3]):[0-5][0-9]$"
                                         error="No es una hora v치lida!" style="width:120px;margin:0px 0px 0px 0px;">
                            </paper-input>
                        </div>
                    </div>
                    <div layout horizontal style="">
                        <div>
                            <label center center-justified>{{messages.toDate}}: </label>
                            <paper-input id="dateFrom" value={{dateToValue}} on-input="{{validateForm}}" floatinglabel label="Fecha (dd/mm/aaaa)"
                                         validate="^(?:(?:31(\/|-|\.)(?:0?[13578]|1[02]))\1|(?:(?:29|30)(\/|-|\.)(?:0?[1,3-9]|1[0-2])\2))(?:(?:1[6-9]|[2-9]\d)?\d{2})$|^(?:29(\/|-|\.)0?2\3(?:(?:(?:1[6-9]|[2-9]\d)?(?:0[48]|[2468][048]|[13579][26])|(?:(?:16|[2468][048]|[3579][26])00))))$|^(?:0?[1-9]|1\d|2[0-8])(\/|-|\.)(?:(?:0?[1-9])|(?:1[0-2]))\4(?:(?:1[6-9]|[2-9]\d)?\d{2})$"
                                         error="No es una fecha v치lida!" style="width:170px; margin:0px 10px 0px 10px;">
                            </paper-input>
                        </div>
                        <div>
                            <paper-input id="hourTo" value={{dateToHour}} on-input="{{validateForm}}" floatinglabel label="Hora (HH:mm)"
                                         validate="^([01]?[0-9]|2[0-3]):[0-5][0-9]$"
                                         error="No es una hora v치lida!" style="width:120px;margin:0px 0px 0px 0px;">
                            </paper-input>
                        </div>
                    </div>
                    <div layout horizontal center center-justified style="margin:10px 0px 0px 0px;">
                        <paper-input id="searchInputMessage" value="{{searchInputMessageValue}}" label="{{messages.searchInputMessage}}" on-input="{{validateForm}}"></paper-input>
                    </div>
                </div>




            </x-dialog>


        </div>

    </template>

    <script>

        Polymer('votingsystem-advanced-search-dialog', {
            isValidForm:false,
            searchInputMessageValue:'init',

            messagesLoaded:function() {
                console.log("votingsystem-advanced-search-dialog - messages for locale " + userLocale)
                this.messages = localizedMessages
            },
            ready: function() {
                var isInputDateSupported = this.checkInputType("date")
                console.log(" - isDateSupported: " + isInputDateSupported)
                if(isInputDateSupported) {
                    this.$.dateSupportedDiv.style.display = 'block'
                    this.$.dateNotSupportedDiv.style.display = 'none'
                } else {
                    this.$.dateSupportedDiv.style.display = 'none'
                    this.$.dateNotSupportedDiv.style.display = 'block'
                }

                //console.log("this.messages: " + JSON.stringify(this.messages))

            },

            resetForm:function() {
                this.searchInputMessageValue = ""
                this.fromDateValue = ""
            },

            validateForm: function() {
                if(this.$ == null) return
                if(this.$.searchInputMessage.inputValue.length > 0 && !this.$.searchInputMessage.invalid) {
                    this.isValidForm = true;
                } else this.isValidForm = false;
                console.log('validateForm - searchInputMessage invalid: ' + this.$.searchInputMessage.invalid + " - isValidForm: " +
                        this.isValidForm + " - inputValue.length: " + this.$.searchInputMessage.inputValue.length +
                        " - value.length: " + this.$.searchInputMessage.value.length)
            },


            /**
             * The `submit-form` event with the form data
             *
             * @event submit-form
             */
            submitForm: function() {
                console.log('submitForm')
                this.fire('submit-form', {name: "Probando"});
            },


            /**
             * Set opened to true to show the dialog and to false to hide it.
             * A dialog may be made intially opened by setting its opened attribute.

             * @attribute opened
             * @type boolean
             * @default false
             */
            opened: false,

            /**
             * @attribute heading
             * @type string
             * @default ''
             */
            heading: '',

            /**
             * Set this property to the id of a <core-transition> element to specify
             * the transition to use when opening/closing this dialog.
             *
             * @attribute transition
             * @type string
             * @default ''
             */
            transition: '',

            /**
             * Toggle the dialog's opened state.
             * @method toggle
             */
            toggle: function() {
                this.$.searchDialog.toggle();
            },

            checkInputType:function(inputType) {
                if(navigator.userAgent.toLowerCase().indexOf("javafx") > -1) return false;
                if(null == inputType || '' == inputType.trim()) return false
                var isSuppported = true
                var elem = document.createElement("input");
                elem.type = inputType;
                if (elem.disabled || elem.type != inputType) isSuppported = false;
                if("text" != inputType.toLowerCase()) {
                    try {
                        elem.value = "Test";
                        if(elem.value == "Test") isSuppported = false;
                    } catch(e) { console.log(e) }
                }
                return isSuppported
            }

        });

    </script>

</polymer-element>
